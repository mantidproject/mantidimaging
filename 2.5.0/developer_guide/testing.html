<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  
    <title>Testing - MantidImaging 2.5.0 Documentation</title>
  
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=514cf933" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css?v=c0834052" />
    
    <script src="../_static/documentation_options.js?v=3c4615cf"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Support" href="../support.html" />
    <link rel="prev" title="Creating a Release" href="release.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../support.html" title="Support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="release.html" title="Creating a Release"
             accesskey="P">previous</a> |</li>
  
        <li class="nav-item nav-item-0"><a href="../index.html">MantidImaging 2.5.0 Documentation</a> &#187;</li>
  
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Testing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h1>
<p>Mantid Imaging uses unit tests, static analysis and GUI approval testing</p>
<p>The full test suite can be run using our makefile target.</p>
<p>On Linux, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">check</span>
</pre></div>
</div>
<p>On Windows, you will need to install a Windows version of GNU Make.
There are a number of options available, so please speak to other developers on the team if you are struggling to find a suitable installation.</p>
<p>Tests are run automatically on pull requests on GitHub using actions, but should also be run during development.
The full suite of unit tests can run very slowly on a Windows machine. We recommend selecting only relevant tests to run locally when developing on Windows.</p>
<section id="pre-commit">
<h2>Pre-commit<a class="headerlink" href="#pre-commit" title="Link to this heading">¶</a></h2>
<p>Mantid Imaging uses <a class="reference external" href="https://pre-commit.com/">pre-commit</a> to run pre-commit hooks. This is included in the development
conda environment and can be installed by using <cite>pip install pre-commit</cite>. After installation, you can then install the
hook scripts with <cite>pre-commit install</cite>. Once this has been completed, the hooks should execute with every commit.</p>
</section>
<section id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Link to this heading">¶</a></h2>
<p>Unit tests can be run using <a class="reference external" href="https://docs.pytest.org/">pytest</a>, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span>
</pre></div>
</div>
<p>For options such as running a subset of tests, see <a class="reference external" href="https://docs.pytest.org/en/stable/usage.html">PyTest Docs</a></p>
</section>
<section id="static-analysis">
<h2>Static analysis<a class="headerlink" href="#static-analysis" title="Link to this heading">¶</a></h2>
<p>Mantid Imaging uses <a class="reference external" href="http://mypy-lang.org/">mypy</a>, <a class="reference external" href="https://flake8.pycqa.org/">flake8</a> and <a class="reference external" href="https://github.com/google/yapf">yapf</a> for static analysis and formatting. They are run by <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code>, or can be run individually, e.g. <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">mypy</span></code>.</p>
</section>
<section id="gui-screenshot-testing">
<h2>GUI screenshot testing<a class="headerlink" href="#gui-screenshot-testing" title="Link to this heading">¶</a></h2>
<p>Mantid Imaging uses <a class="reference external" href="https://applitools.com/products-eyes/">Applitools Eyes</a> for GUI approval testing. Screenshots of windows are uploaded and compared to known good baseline images. This is run in the github action on pull requests.</p>
<p>Applitools requires an API key to use, which can be found via the Applitools web interface. On a developer machine this can be passed as an environment variable. E.g.</p>
<p>Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">APPLITOOLS_API_KEY</span><span class="o">=</span><span class="n">XXXXXXXXXX</span> <span class="n">xvfb</span><span class="o">-</span><span class="n">run</span> <span class="o">--</span><span class="n">auto</span><span class="o">-</span><span class="n">servernum</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">xdist</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">randomly</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">repeat</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">cov</span> <span class="n">mantidimaging</span><span class="o">/</span><span class="n">eyes_tests</span>
</pre></div>
</div>
<p>Windows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">APPLITOOLS_API_KEY</span><span class="o">=</span><span class="n">XXXXXXXXXX</span><span class="o">&amp;&amp;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">xdist</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">randomly</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">repeat</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">cov</span> <span class="n">mantidimaging</span><span class="o">/</span><span class="n">eyes_tests</span>
</pre></div>
</div>
<p>Differences between uploaded and baseline images can be examined and approved or rejected from the Applitools web interface.</p>
<p>To run without a key or to prevent uploads, set <code class="docutils literal notranslate"><span class="pre">APPLITOOLS_API_KEY</span></code> to <code class="docutils literal notranslate"><span class="pre">local</span></code> and choose a directory to save the screenshots. Note that this does not check for changes, and will always pass. e.g.</p>
<p>Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">gui_test</span>
<span class="n">APPLITOOLS_API_KEY</span><span class="o">=</span><span class="n">local</span> <span class="n">APPLITOOLS_IMAGE_DIR</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">gui_test</span> <span class="n">xvfb</span><span class="o">-</span><span class="n">run</span> <span class="o">--</span><span class="n">auto</span><span class="o">-</span><span class="n">servernum</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">xdist</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">randomly</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">repeat</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">cov</span> <span class="n">mantidimaging</span><span class="o">/</span><span class="n">eyes_tests</span>
</pre></div>
</div>
<p>Windows:</p>
<p>In the command below, replace <code class="code docutils literal notranslate"><span class="pre">[path_to_output_directory]</span></code> with the path to the directory that you would like to save the screenshots to.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">APPLITOOLS_API_KEY</span><span class="o">=</span><span class="n">local</span><span class="o">&amp;&amp;</span> <span class="nb">set</span> <span class="n">APPLITOOLS_IMAGE_DIR</span><span class="o">=</span><span class="p">[</span><span class="n">path_to_output_directory</span><span class="p">]</span><span class="o">&amp;&amp;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">xdist</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">randomly</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">repeat</span> <span class="o">-</span><span class="n">p</span> <span class="n">no</span><span class="p">:</span><span class="n">cov</span> <span class="n">mantidimaging</span><span class="o">/</span><span class="n">eyes_tests</span>
</pre></div>
</div>
</section>
<section id="gui-system-tests">
<h2>GUI system tests<a class="headerlink" href="#gui-system-tests" title="Link to this heading">¶</a></h2>
<p>GUI system tests run work flows in Mantid Imaging in a ‘realistic’ way, where possible by using QTest methods to emulate mouse and keyboard actions. They use the same data files as the GUI screenshot tests. These take several minutes to run (longer on Windows) and so must be explicitly requested.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">tests</span>
</pre></div>
</div>
<p>or in virtual X server xvfb-run (Linux only)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xvfb</span><span class="o">-</span><span class="n">run</span> <span class="o">--</span><span class="n">auto</span><span class="o">-</span><span class="n">servernum</span> <span class="n">pytest</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">tests</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#pre-commit">Pre-commit</a></li>
<li><a class="reference internal" href="#unit-testing">Unit testing</a></li>
<li><a class="reference internal" href="#static-analysis">Static analysis</a></li>
<li><a class="reference internal" href="#gui-screenshot-testing">GUI screenshot testing</a></li>
<li><a class="reference internal" href="#gui-system-tests">GUI system tests</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="release.html"
                          title="previous chapter">Creating a Release</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../support.html"
                          title="next chapter">Support</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
<div class="versions">
<h3>Versions</h3>
<ul>
  <li><a href="../../index.html">Latest</a></li>
  <li><a href="../../2.3.0/developer_guide/testing.html">2.3.0</a></li>
  <li><a href="../../2.4.0/developer_guide/testing.html">2.4.0</a></li>
  <li><a href="testing.html">2.5.0</a></li>
  <li><a href="../../2.6.0/developer_guide/testing.html">2.6.0</a></li>
  <li><a href="../../2.7.0/developer_guide/testing.html">2.7.0</a></li>
</ul>
</div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../support.html" title="Support"
             >next</a> |</li>
        <li class="right" >
          <a href="release.html" title="Creating a Release"
             >previous</a> |</li>
  
        <li class="nav-item nav-item-0"><a href="../index.html">MantidImaging 2.5.0 Documentation</a> &#187;</li>
  
          <li class="nav-item nav-item-1"><a href="index.html" >Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Testing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2017-2024, Mantid Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>